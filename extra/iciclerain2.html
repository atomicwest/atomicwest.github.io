<!DOCTYPE html>

<html>
	<meta charset="utf-8"/>
	<script src="https://code.createjs.com/createjs-2015.05.21.min.js"></script>
	<script src="https://code.createjs.com/easeljs-0.8.1.min.js"></script>
	<script src="https://code.createjs.com/tweenjs-0.6.1.min.js"></script>

<head>
	<title>NeoRain</title>
</head>

<script>
	var container;
	//this variable helps determine where on the screen the objects start from
	var ishort = 90;
	var canvas;
	var stage;
	var count = 0;
	var backgroundmain;
	
	function init(){
		canvas = document.getElementById("raincan")
		stage = new createjs.Stage(canvas);
		
		//create a black backdrop for the animation
		backgroundmain = new createjs.Shape();
		//backgroundmain.graphics.beginFill("black").drawRect(0,0,canvas.width, canvas.height);
		//manually adding the canvas dimensions declared at the bottom
		backgroundmain.graphics.beginFill("black").drawRect(-10,-10,8000, 3000);
		stage.addChild(backgroundmain);
		stage.update();
		
		var gradient = ['#e5f2ff','#cce5ff','#99ccff','#66b2ff','#3399ff','#007fff','#0066cc','#004c99','#003366','#000d1a'];
		
		for (var i=1; i<15; i++){
			var drop = new createjs.Shape();
			
			for(var v=gradient.length; v>0; v--){
				drop.graphics.beginFill(gradient[gradient.length-v]);
				drop.graphics.moveTo(30+1.5*v,30-3*v).lineTo(40,20-3*v).lineTo(50-1.5*v,30-3*v).lineTo(40,100-5*v).lineTo(30+1.5*v,30-3*v);
			}
		/*
			var randtxt = new createjs.Text("Icicle Drop", "bold 13px italic", "#66ffc2" );
			randtxt.x = 40;
			randtxt.y = 25;
		*/
		
			container = new createjs.Container();
			container.addChild(drop);
			//container.x = 140;
			//container.y = 20;
			container.x = Math.floor(Math.random()*canvas.width);
			container.y = Math.floor(Math.random()*canvas.height);
			//container.y = 0;
			
			container.velx = Math.random() * 10 - 4;
			container.vely = Math.random() * 10 - 4;
			//not sure if snapToPixel is an attribute for container?
			container.snapToPixel = true;
			

			/*
			createjs.Tween.get(container, {loop: true})				
				//endx = container.x + Math.floor(Math.random()*10);
				endy = container.y + Math.floor(Math.random()*200);
				.to({alpha:0,y: endy },1000)
			*/
			//createjs.Ticker.setFPS(200);
			
			toggleCache(true);
			
			createjs.Ticker.timingMode = createjs.Ticker.RAF;
			createjs.Ticker.addEventListener("tick",tick);	
			
			stage.addChild(container);
			stage.update();
			
		};
		
		stage.update();
	
	}
	
	function tick(event){
		var w = canvas.width + ishort * 2;
		var h = canvas.height + ishort *2;
		var l = stage.getNumChildren()-1;
		console.log(stage.getNumChildren())
		
		//iterate through the number of children
		//vary their velocities based on shape attributes defined in init()
		for (var i=1; i<l; i++){
				var shape = stage.getChildAt(i);
				//shape.x = (shape.x + ishort + shape.velx + w) % w - ishort;
				shape.y = (shape.y + ishort + shape.vely + h) % h - ishort;
				
			};
		
		
		stage.update(event);
	}
	
	function toggleCache(value){
		var l = stage.getNumChildren()-1;
		
		for (var i=0; i<l; i++){
			var shape = stage.getChildAt(i);
			if(value){
				shape.cache(-ishort, -ishort, ishort*2, ishort*2);
			}
			else{
				shape.uncache();
			}
		}
	
	}
	
</script>


<body onLoad="init();">
	<canvas id="raincan" width="800" height="300"></canvas>
</body>

</html>
